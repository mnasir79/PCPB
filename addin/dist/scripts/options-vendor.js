"use strict";angular.module("chromeStorage",[]).factory("chromeStorage",function(e){var r=null;try{r=chrome.storage.local}catch(o){console.log("could not initiate chrome local storage: "+o)}var n=null,t={},c=function(o){var n=e.defer();return r.getBytesInUse(o,function(e){chrome.runtime.lasterror?(console.log("error retrieving bytes in use for keys "+o),n.reject(chrome.runtime.lasterror.message)):(console.log("retrieved bytes in use for keys "+o+": "+e),n.resolve(e))}),n.promise};return{getDebuggingTotalBytesInUse:function(){return n},getDebuggingCache:function(){return t},getDebuggingPercentUsed:function(){var e=n/r.QUOTA_BYTES;return e},getDebuggingSizeOf:function(e){return angular.toJson(t[e]).length},updateDebuggingCache:function(){var o=e.defer();r.get(null,function(e){chrome.runtime.lasterror?o.reject(chrome.runtime.lasterror.message):o.resolve(e)}),o.promise.then(function(e){t=e})},updateDebuggingTotalBytes:function(){c(null).then(function(e){console.log("total bytes in use: "+e),n=e})},clearCache:function(){r.clear(function(){chrome.runtime.lastError?console.error("error clearing local cache"+chrome.runtime.lastError):console.log("cache has been cleared")})},drop:function(e){r.remove(e,function(){chrome.runtime.lasterror&&console.error(chrome.runtime.lasterror.message)})},get:function(o){var n=e.defer();return r.get(o,function(e){var r=e[o];n.resolve(r)}),n.promise},getOrElse:function(o,n){var t=e.defer();return r.get(o,function(e){var c=e[o];void 0==c||null==c?n().then(function(e){c=e;var n={};n[o]=c,r.set(n,function(){chrome.runtime.lasterror&&console.error(chrome.runtime.lasterror.message)}),t.resolve(c)}):t.resolve(c)}),t.promise},set:function(e,o){var n={};n[e]=o,r.set(n,function(){chrome.runtime.lasterror&&console.error(chrome.runtime.lasterror.message)})},forceGet:function(o,n){var t=e.defer();return n().then(function(e){keyValue=e;var n={};n[o]=keyValue,r.set(n,function(){chrome.runtime.lasterror&&console.error(chrome.runtime.lasterror.message)}),t.resolve(keyValue)}),t.promise},getQuota:function(){return r.QUOTA_BYTES}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMvb3B0aW9ucy12ZW5kb3IuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImZhY3RvcnkiLCIkcSIsImFyZWEiLCJjaHJvbWUiLCJzdG9yYWdlIiwibG9jYWwiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwidG90YWxCeXRlcyIsImNhY2hlIiwiZ2V0Qnl0ZXNJblVzZSIsImtleXMiLCJkZWZlcnJlZCIsImRlZmVyIiwiYnl0ZXNJblVzZSIsInJ1bnRpbWUiLCJsYXN0ZXJyb3IiLCJyZWplY3QiLCJtZXNzYWdlIiwicmVzb2x2ZSIsInByb21pc2UiLCJnZXREZWJ1Z2dpbmdUb3RhbEJ5dGVzSW5Vc2UiLCJnZXREZWJ1Z2dpbmdDYWNoZSIsImdldERlYnVnZ2luZ1BlcmNlbnRVc2VkIiwicGVyY2VudCIsIlFVT1RBX0JZVEVTIiwiZ2V0RGVidWdnaW5nU2l6ZU9mIiwia2V5IiwidG9Kc29uIiwibGVuZ3RoIiwidXBkYXRlRGVidWdnaW5nQ2FjaGUiLCJnZXQiLCJ2YWx1ZSIsInRoZW4iLCJkYXRhIiwidXBkYXRlRGVidWdnaW5nVG90YWxCeXRlcyIsImNsZWFyQ2FjaGUiLCJjbGVhciIsImxhc3RFcnJvciIsImVycm9yIiwiZHJvcCIsInJlbW92ZSIsImtleVZhbHVlIiwiZ2V0T3JFbHNlIiwiZmFsbGJhY2siLCJ1bmRlZmluZWQiLCJzYXZlT2JqZWN0Iiwic2V0IiwiZm9yY2VHZXQiLCJnZXRRdW90YSJdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQUEsU0FBUUMsT0FBTyxvQkFDYkMsUUFBUSxnQkFBaUIsU0FBU0MsR0FDbkMsR0FBSUMsR0FBTyxJQUNYLEtBQ0NBLEVBQU9DLE9BQU9DLFFBQVFDLE1BQ3JCLE1BQU9DLEdBQ1JDLFFBQVFDLElBQUksNENBQThDRixHQU0zRCxHQUFJRyxHQUFhLEtBQ2JDLEtBTUFDLEVBQWdCLFNBQVVDLEdBQzFCLEdBQUlDLEdBQVdaLEVBQUdhLE9BYWxCLE9BWEFaLEdBQUtTLGNBQWNDLEVBQU0sU0FBU0csR0FDMUJaLE9BQU9hLFFBQVFDLFdBQ2xCVixRQUFRQyxJQUFJLDBDQUE0Q0ksR0FDckRDLEVBQVNLLE9BQU9mLE9BQU9hLFFBQVFDLFVBQVVFLFdBRzVDWixRQUFRQyxJQUFJLG1DQUFxQ0ksRUFBTyxLQUFPRyxHQUM1REYsRUFBU08sUUFBUUwsTUFJbEJGLEVBQVNRLFFBR2xCLFFBQ0NDLDRCQUE2QixXQUM1QixNQUFPYixJQUVYYyxrQkFBbUIsV0FDbEIsTUFBT2IsSUFLUmMsd0JBQXlCLFdBQ3hCLEdBQUlDLEdBQVVoQixFQUFhUCxFQUFLd0IsV0FDaEMsT0FBT0QsSUFFUkUsbUJBQW9CLFNBQVNDLEdBQzVCLE1BQU85QixTQUFRK0IsT0FBT25CLEVBQU1rQixJQUFNRSxRQUVuQ0MscUJBQXNCLFdBQ3JCLEdBQUlsQixHQUFXWixFQUFHYSxPQUNsQlosR0FBSzhCLElBQUksS0FBTSxTQUFVQyxHQUNwQjlCLE9BQU9hLFFBQVFDLFVBQ1RKLEVBQVNLLE9BQU9mLE9BQU9hLFFBQVFDLFVBQVVFLFNBR3pDTixFQUFTTyxRQUFRYSxLQUc1QnBCLEVBQVNRLFFBQVFhLEtBQU0sU0FBVUMsR0FDaEN6QixFQUFReUIsS0FHVkMsMEJBQTJCLFdBQzFCekIsRUFBYyxNQUFNdUIsS0FBSyxTQUFTQyxHQUNqQzVCLFFBQVFDLElBQUksdUJBQXlCMkIsR0FDckMxQixFQUFhMEIsS0FHWkUsV0FBWSxXQUVkbkMsRUFBS29DLE1BQU0sV0FDTm5DLE9BQU9hLFFBQVF1QixVQUNaaEMsUUFBUWlDLE1BQU0sNkJBQStCckMsT0FBT2EsUUFBUXVCLFdBRS9EaEMsUUFBUUMsSUFBSSw2QkFJbEJpQyxLQUFNLFNBQVNiLEdBQ2QxQixFQUFLd0MsT0FBT2QsRUFBSyxXQUNaekIsT0FBT2EsUUFBUUMsV0FDVFYsUUFBUWlDLE1BQU1yQyxPQUFPYSxRQUFRQyxVQUFVRSxZQU1uRGEsSUFBSyxTQUFTSixHQUNiLEdBQUlmLEdBQVdaLEVBQUdhLE9BTWxCLE9BTEFaLEdBQUs4QixJQUFJSixFQUFLLFNBQVVLLEdBRWpCLEdBQUlVLEdBQVdWLEVBQU1MLEVBQ2xCZixHQUFTTyxRQUFRdUIsS0FFcEI5QixFQUFTUSxTQU1qQnVCLFVBQVcsU0FBU2hCLEVBQUtpQixHQUV4QixHQUFJaEMsR0FBV1osRUFBR2EsT0F3QmxCLE9BdkJNWixHQUFLOEIsSUFBSUosRUFBSyxTQUFTSyxHQUV0QixHQUFJVSxHQUFXVixFQUFNTCxFQUNMa0IsU0FBWkgsR0FBcUMsTUFBWkEsRUFFNUJFLElBQVdYLEtBQUssU0FBU0MsR0FDeEJRLEVBQVdSLENBRVgsSUFBSVksS0FDSkEsR0FBV25CLEdBQU9lLEVBQ2xCekMsRUFBSzhDLElBQUlELEVBQVksV0FDaEI1QyxPQUFPYSxRQUFRQyxXQUNmVixRQUFRaUMsTUFBTXJDLE9BQU9hLFFBQVFDLFVBQVVFLFdBSzVDTixFQUFTTyxRQUFRdUIsS0FHbEI5QixFQUFTTyxRQUFRdUIsS0FHbEI5QixFQUFTUSxTQUtqQjJCLElBQUssU0FBU3BCLEVBQUtLLEdBQ2xCLEdBQUljLEtBQ0pBLEdBQVduQixHQUFPSyxFQUNsQi9CLEVBQUs4QyxJQUFJRCxFQUFZLFdBQ2hCNUMsT0FBT2EsUUFBUUMsV0FDZlYsUUFBUWlDLE1BQU1yQyxPQUFPYSxRQUFRQyxVQUFVRSxZQVc3QzhCLFNBQVUsU0FBU3JCLEVBQUtpQixHQUV2QixHQUFJaEMsR0FBV1osRUFBR2EsT0FlbEIsT0FkTStCLEtBQVdYLEtBQUssU0FBU0MsR0FDOUJRLFNBQVdSLENBRVgsSUFBSVksS0FDSkEsR0FBV25CLEdBQU9lLFNBQ2xCekMsRUFBSzhDLElBQUlELEVBQVksV0FDaEI1QyxPQUFPYSxRQUFRQyxXQUNUVixRQUFRaUMsTUFBTXJDLE9BQU9hLFFBQVFDLFVBQVVFLFdBS2xETixFQUFTTyxRQUFRdUIsWUFFWDlCLEVBQVNRLFNBS2pCNkIsU0FBVSxXQUNULE1BQU9oRCxHQUFLd0IiLCJmaWxlIjoic2NyaXB0cy9vcHRpb25zLXZlbmRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoXCJjaHJvbWVTdG9yYWdlXCIsW10pXG5cdC5mYWN0b3J5KCdjaHJvbWVTdG9yYWdlJywgZnVuY3Rpb24oJHEpIHtcblx0dmFyIGFyZWEgPSBudWxsO1xuXHR0cnkge1xuXHRcdGFyZWEgPSBjaHJvbWUuc3RvcmFnZS5sb2NhbDsgLy8gY2hhbmdlIHRoaXMgdG8gY2hyb21lLnN0b3JhZ2Uuc3luYyBmb3Igc3luYyBjYXBhYmlsaXRpZXNcblx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0Y29uc29sZS5sb2coXCJjb3VsZCBub3QgaW5pdGlhdGUgY2hyb21lIGxvY2FsIHN0b3JhZ2U6IFwiICsgZXJyKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBUaGVzZSBhcmUgcHJvdmlkZWQgYW5kIHVwZGF0ZWQgb25seSBmb3IgZGVidWdnaW5nIHB1cnBvc2VzLlxuXHQgKi9cblx0dmFyIHRvdGFsQnl0ZXMgPSBudWxsO1xuXHR2YXIgY2FjaGUgPSB7fTtcblxuXHQvKipcblx0ICogQSBjYWxsIHRvIGdldCB0aGUgYnl0ZXMgaW4gdXNlLCByZXR1cm5zIGEgcHJvbWlzZSBvZiB0aGUgc2l6ZSBvZiBhbiBpbmRpdmlkdWFsIGtleSwgb3Jcblx0ICogb2YgdG90YWwgYnl0ZXMgaW4gdXNlLCBpZiBubyBrZXkgaXMgc3BlY2lmaWVkLlxuXHQgKi9cblx0dmFyIGdldEJ5dGVzSW5Vc2UgPSBmdW5jdGlvbiAoa2V5cyl7XG5cdCAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG5cdCAgICBhcmVhLmdldEJ5dGVzSW5Vc2Uoa2V5cywgZnVuY3Rpb24oYnl0ZXNJblVzZSkge1xuXHQgICAgICAgIGlmIChjaHJvbWUucnVudGltZS5sYXN0ZXJyb3Ipe1xuXHQgICAgICAgIFx0Y29uc29sZS5sb2coXCJlcnJvciByZXRyaWV2aW5nIGJ5dGVzIGluIHVzZSBmb3Iga2V5cyBcIiArIGtleXMpO1xuXHQgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoY2hyb21lLnJ1bnRpbWUubGFzdGVycm9yLm1lc3NhZ2UpO1xuXHQgICAgICAgIH1cblx0ICAgICAgICBlbHNlIHtcblx0ICAgICAgICBcdGNvbnNvbGUubG9nKFwicmV0cmlldmVkIGJ5dGVzIGluIHVzZSBmb3Iga2V5cyBcIiArIGtleXMgKyBcIjogXCIgKyBieXRlc0luVXNlKTtcblx0ICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShieXRlc0luVXNlKTtcblx0ICAgICAgICB9XG5cdCAgICB9KTtcblxuXHQgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cdH1cblxuICAgcmV0dXJuIHtcbiAgIFx0Z2V0RGVidWdnaW5nVG90YWxCeXRlc0luVXNlOiBmdW5jdGlvbigpIHtcbiAgIFx0XHRyZXR1cm4gdG90YWxCeXRlcztcbiAgIFx0fSxcblx0Z2V0RGVidWdnaW5nQ2FjaGU6IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiBjYWNoZTtcblx0fSxcblx0LyoqXG5cdCAqIFJldHVybnMgdGhlIHVzYWdlIG9mIHRoZSBjdXJyZW50IHN0b3JhZ2UgcXVvdGEsIGFzIGEgbnVtYmVyIGJldHdlZW4gMC4wIGFuZCAxLjBcblx0ICovXG5cdGdldERlYnVnZ2luZ1BlcmNlbnRVc2VkOiBmdW5jdGlvbigpIHtcblx0XHR2YXIgcGVyY2VudCA9IHRvdGFsQnl0ZXMgLyBhcmVhLlFVT1RBX0JZVEVTO1xuXHRcdHJldHVybiBwZXJjZW50O1xuXHR9LFxuXHRnZXREZWJ1Z2dpbmdTaXplT2Y6IGZ1bmN0aW9uKGtleSkge1xuXHRcdHJldHVybiBhbmd1bGFyLnRvSnNvbihjYWNoZVtrZXldKS5sZW5ndGg7XG5cdH0sXG5cdHVwZGF0ZURlYnVnZ2luZ0NhY2hlOiBmdW5jdGlvbigpIHtcblx0XHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXHRcdGFyZWEuZ2V0KG51bGwsIGZ1bmN0aW9uICh2YWx1ZSkge1xuXHRcdFx0aWYgKGNocm9tZS5ydW50aW1lLmxhc3RlcnJvcil7XG5cdCAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChjaHJvbWUucnVudGltZS5sYXN0ZXJyb3IubWVzc2FnZSk7XG5cdCAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgIC8vY29uc29sZS5sb2coJ2dldCB0aGVuIGZvciBhbGwga2V5cyA6ICcgKyBhbmd1bGFyLnRvSnNvbih2YWx1ZSkpO1xuICBcdCAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHZhbHVlKTtcbiAgXHQgICAgICAgIH1cblx0XHR9KTtcblx0XHRkZWZlcnJlZC5wcm9taXNlLnRoZW4gKGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0XHRjYWNoZSA9IGRhdGE7XG5cdFx0fSk7XG5cdH0sXG5cdHVwZGF0ZURlYnVnZ2luZ1RvdGFsQnl0ZXM6IGZ1bmN0aW9uKCkge1xuXHRcdGdldEJ5dGVzSW5Vc2UobnVsbCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG5cdFx0XHRjb25zb2xlLmxvZyhcInRvdGFsIGJ5dGVzIGluIHVzZTogXCIgKyBkYXRhKTtcblx0XHRcdHRvdGFsQnl0ZXMgPSBkYXRhO1xuXHRcdH0pO1xuXHR9LFxuICAgIGNsZWFyQ2FjaGU6IGZ1bmN0aW9uKCkge1xuXHRcdC8vIGNvbnNvbGUubG9nKCdjbGVhcmluZyBsb2NhbCBjYWNoZScpO1xuXHRcdGFyZWEuY2xlYXIoZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoY2hyb21lLnJ1bnRpbWUubGFzdEVycm9yKSB7XG5cdFx0ICAgICAgICBjb25zb2xlLmVycm9yKFwiZXJyb3IgY2xlYXJpbmcgbG9jYWwgY2FjaGVcIiArIGNocm9tZS5ydW50aW1lLmxhc3RFcnJvcik7XG5cdFx0ICAgIH0gZWxzZSB7XG5cdCAgICBcdFx0Y29uc29sZS5sb2coXCJjYWNoZSBoYXMgYmVlbiBjbGVhcmVkXCIpO1xuXHQgICAgXHR9XG5cdFx0fSk7XG5cdH0sXG5cdGRyb3A6IGZ1bmN0aW9uKGtleSkge1xuXHRcdGFyZWEucmVtb3ZlKGtleSwgZnVuY3Rpb24oKXtcblx0XHRcdGlmIChjaHJvbWUucnVudGltZS5sYXN0ZXJyb3Ipe1xuXHQgICAgICAgICAgICBjb25zb2xlLmVycm9yKGNocm9tZS5ydW50aW1lLmxhc3RlcnJvci5tZXNzYWdlKTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgIFx0Ly8gY29uc29sZS5sb2coXCJrZXkgXCIgKyBrZXkgKyBcIiBoYXMgYmVlbiBkcm9wcGVkIGZyb20gdGhlIHN0b3JhZ2UgY2FjaGVcIilcblx0ICAgICAgICB9XG5cdFx0fSk7XG5cdH0sXG5cdGdldDogZnVuY3Rpb24oa2V5KSB7XG5cdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblx0XHRhcmVhLmdldChrZXksIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICBcdC8vIGNvbnNvbGUubG9nKCdnZXRUb3RhbEJ5dGVzSW5Vc2UgdGhlbiB3aXRoIGtleSAnICsga2V5ICsgXCIgOiBcIiArIGFuZ3VsYXIudG9Kc29uKHZhbHVlKSk7XG4gICAgICAgIFx0dmFyIGtleVZhbHVlID0gdmFsdWVba2V5XTtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoa2V5VmFsdWUpO1xuXHRcdH0pO1xuXHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXHR9LFxuXHQvKipcblx0ICogZ2V0cyB0aGUgdmFsdWUgb2Yga2V5IGZyb20gdGhlIGNhY2hlLCBvciBjYWxscyB0aGUgZmFsbGJhY2sgZnVuY3Rpb24sIGFuZCBwb3B1bGF0ZXMgdGhlIGNhY2hlXG5cdCAqIHdpdGggdGhlIHZhbHVlIG9mIHRoZSBwcm9taXNlIHJldHVybmVkXG5cdCAqL1xuXHRnZXRPckVsc2U6IGZ1bmN0aW9uKGtleSwgZmFsbGJhY2spIHtcblx0XHQvLyBjb25zb2xlLmxvZygnZ2V0T3JFbHNlIGNhbGxlZCB3aXRoICBjYWNoZWQga2V5ICcgKyBrZXkpO1xuXHRcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgIGFyZWEuZ2V0KGtleSwgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgXHQvLyBjb25zb2xlLmxvZygnZ2V0T3JFbHNlIHRoZW4gd2l0aCBjYWNoZWQga2V5ICcgKyBrZXkgKyBcIiA6IFwiICsgYW5ndWxhci50b0pzb24odmFsdWUpKTtcbiAgICAgICAgXHR2YXIga2V5VmFsdWUgPSB2YWx1ZVtrZXldO1xuICAgICAgICBcdGlmIChrZXlWYWx1ZSA9PSB1bmRlZmluZWQgfHwga2V5VmFsdWUgPT0gbnVsbCkge1xuICAgICAgICBcdFx0Ly8gY29uc29sZS5sb2coXCJubyBjYWNoZWQgdmFsdWUgZm9yIFwiKyBrZXkgKyBcIi4gdXNpbmcgZmFsbGJhY2sgbWV0aG9kLlwiKTtcbiAgICAgICAgXHRcdGZhbGxiYWNrKCkudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIFx0XHRcdGtleVZhbHVlID0gZGF0YTtcbiAgICAgICAgXHRcdFx0Ly8gY29uc29sZS5sb2coXCJjYWNoaW5nIHZhbHVlIGZvciBcIisga2V5ICsgXCIgOiBcIiArIGFuZ3VsYXIudG9Kc29uKGtleVZhbHVlKSk7XG4gICAgICAgIFx0XHRcdHZhciBzYXZlT2JqZWN0ID0ge307XG4gICAgICAgIFx0XHRcdHNhdmVPYmplY3Rba2V5XSA9IGtleVZhbHVlO1xuICAgICAgICBcdFx0XHRhcmVhLnNldChzYXZlT2JqZWN0LCBmdW5jdGlvbigpIHtcbiAgICAgICAgXHRcdFx0XHRpZiAoY2hyb21lLnJ1bnRpbWUubGFzdGVycm9yKXtcblx0XHRcdFx0ICAgICAgICAgICAgY29uc29sZS5lcnJvcihjaHJvbWUucnVudGltZS5sYXN0ZXJyb3IubWVzc2FnZSk7XG5cdFx0XHRcdCAgICAgICAgfSBlbHNlIHtcblx0XHQgICAgXHRcdFx0XHQvL2NvbnNvbGUubG9nKCdzYXZlZCAnICsga2V5VmFsdWUgKyBcIiB0byBrZXkgXCIgKyBrZXkpO1xuXHRcdCAgICBcdFx0XHR9XG4gICAgICAgIFx0XHRcdH0pO1xuICAgICAgICBcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKGtleVZhbHVlKTtcbiAgICAgICAgXHRcdH0pO1xuICAgICAgICBcdH0gZWxzZSB7XG5cdCAgICAgICAgXHRkZWZlcnJlZC5yZXNvbHZlKGtleVZhbHVlKTtcblx0ICAgICAgICB9XG4gICAgICAgIH0pO1xuXHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXHR9LFxuXHQvKipcblx0KlxuXHQqL1xuXHRzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcblx0XHR2YXIgc2F2ZU9iamVjdCA9IHt9O1xuXHRcdHNhdmVPYmplY3Rba2V5XSA9IHZhbHVlO1xuXHRcdGFyZWEuc2V0KHNhdmVPYmplY3QsIGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKGNocm9tZS5ydW50aW1lLmxhc3RlcnJvcil7XG5cdFx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoY2hyb21lLnJ1bnRpbWUubGFzdGVycm9yLm1lc3NhZ2UpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coJ3NhdmVkICcgKyBrZXlWYWx1ZSArIFwiIHRvIGtleSBcIiArIGtleSk7XG5cdFx0XHRcdH1cblx0XHR9KTtcblx0fSxcblxuXHQvKipcblx0ICogZ2V0cyB0aGUgdmFsdWUgb2Yga2V5IGZyb20gdGhlIGNhY2hlLCBvciBjYWxscyB0aGUgZmFsbGJhY2sgZnVuY3Rpb24sIGFuZCBwb3B1bGF0ZXMgdGhlIGNhY2hlXG5cdCAqIHdpdGggdGhlIHZhbHVlIG9mIHRoZSBwcm9taXNlIHJldHVybmVkXG5cdCAqL1xuXHRmb3JjZUdldDogZnVuY3Rpb24oa2V5LCBmYWxsYmFjaykge1xuXHRcdC8vIGNvbnNvbGUubG9nKCdnZXRPckVsc2UgY2FsbGVkIHdpdGggIGNhY2hlZCBrZXkgJyArIGtleSk7XG5cdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgZmFsbGJhY2soKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdGtleVZhbHVlID0gZGF0YTtcblx0XHRcdC8vIGNvbnNvbGUubG9nKFwiY2FjaGluZyB2YWx1ZSBmb3IgXCIrIGtleSArIFwiIDogXCIgKyBhbmd1bGFyLnRvSnNvbihrZXlWYWx1ZSkpO1xuXHRcdFx0dmFyIHNhdmVPYmplY3QgPSB7fTtcblx0XHRcdHNhdmVPYmplY3Rba2V5XSA9IGtleVZhbHVlO1xuXHRcdFx0YXJlYS5zZXQoc2F2ZU9iamVjdCwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGlmIChjaHJvbWUucnVudGltZS5sYXN0ZXJyb3Ipe1xuXHRcdCAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoY2hyb21lLnJ1bnRpbWUubGFzdGVycm9yLm1lc3NhZ2UpO1xuXHRcdCAgICAgICAgfSBlbHNlIHtcbiAgICBcdFx0XHRcdC8vY29uc29sZS5sb2coJ3NhdmVkICcgKyBrZXlWYWx1ZSArIFwiIHRvIGtleSBcIiArIGtleSk7XG4gICAgXHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRkZWZlcnJlZC5yZXNvbHZlKGtleVZhbHVlKTtcblx0XHR9KTtcblx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblx0fSxcblx0LyoqXG5cdCAqIFJldHVybnMgdGhlIHF1b3RhIG9mIHRoZSBjdXJyZW50IHN0b3JhZ2UgbWV0aG9kLCBpbiBieXRlc1xuXHQgKi9cblx0Z2V0UXVvdGE6IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiBhcmVhLlFVT1RBX0JZVEVTO1xuXHR9XG5cbiAgIH1cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
